<script is:inline>
  (() => {
    const SPIN_CLASS = "spin";

    const getPluses = () => Array.from(document.querySelectorAll(".corner-plus"));

    const triggerSpin = () => {
      const pluses = getPluses();
      for (const el of pluses) {
        el.classList.remove(SPIN_CLASS);
        void el.offsetWidth; // force reflow so animation restarts
        el.classList.add(SPIN_CLASS);
      }
    };

    const isStudyTrigger = (el) => {
      if (!el) return false;
      const v = el.getAttribute("data-study") || "";
      let val = v;
      try { val = decodeURIComponent(val); } catch (_) {}
      val = val.trim().toLowerCase();
      return val.startsWith("study:") && val.includes("[//");
    };

    document.addEventListener(
      "click",
      (e) => {
        const target = e.target;
        if (!target || !target.closest) return;

        const el = target.closest("[data-study]");
        if (!el) return;

        if (isStudyTrigger(el)) {
          triggerSpin();
        }
      },
      { capture: true }
    );

    document.addEventListener(
      "animationend",
      (e) => {
        const t = e.target;
        if (t && t.classList && t.classList.contains("corner-plus")) {
          t.classList.remove(SPIN_CLASS);
        }
      },
      true
    );
  })();
</script>
