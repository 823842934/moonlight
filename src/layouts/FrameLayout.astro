---
const {
  title = "brandyura",
  description = "brandyura",
  ogImage = "/og.png",
} = Astro.props;

const siteUrl = "https://brandyura.com";
const canonical = new URL(Astro.url.pathname, siteUrl).toString();
const ogImageAbs = new URL(ogImage, siteUrl).toString();
---
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{title}</title>

  <link rel="canonical" href={canonical} />
  <meta name="description" content={description} />

  <meta property="og:site_name" content="brandyura" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:url" content={canonical} />

  <meta property="og:image" content={ogImageAbs} />
  <meta property="og:image:width" content="960" />
  <meta property="og:image:height" content="960" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:alt" content="brandyura preview" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={ogImageAbs} />

  <link rel="icon" href="/favicon.ico" />
  <link rel="preload" href="/fonts/ABCDiatype-Regular.woff" as="font" type="font/woff" crossorigin />
  <link rel="preload" href="/fonts/ABCDiatype-Bold.woff" as="font" type="font/woff" crossorigin />

  <style>
    @font-face {
      font-family: "ABC Diatype";
      src: url("/fonts/ABCDiatype-Regular.woff") format("woff");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: "ABC Diatype";
      src: url("/fonts/ABCDiatype-Bold.woff") format("woff");
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }

    :root {
      --corner-inset: 22px;
      --corner-size: 28px;
      --intro-ms: 800ms;
      --intro-ease: cubic-bezier(.2,.9,.2,1);
      --intro-blur: 18px;
      --intro-scale: 0.985;

      --cascade-ms: 420ms;
      --cascade-stagger: 80ms;
      --cascade-from-opacity: 0.25;
      --cascade-from-y: -10px;
      --cascade-from-blur: 1px;

      --plus-ms: 520ms;
      --plus-ease: cubic-bezier(.22,.61,.36,1);
      --left-scale: 2.1;
      --right-scale: 0.45;

      --connector-gap: 14px;
      --connector-ms: 520ms;
      --connector-ease: cubic-bezier(.22,.61,.36,1);
      --connector-width: 3px;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #ffffff;
      max-width: 100%;
      overflow-x: hidden;
    }

    body {
      font-family: "ABC Diatype", system-ui, sans-serif;
      color: #000000;
      overflow-x: clip;
    }

    .page-intro-wrap {
      min-height: 100%;
      transition: filter var(--intro-ms) var(--intro-ease),
                  transform var(--intro-ms) var(--intro-ease);
      will-change: filter, transform;
    }

    .intro-wash {
      position: fixed;
      inset: 0;
      background: #ffffff;
      z-index: 9000;
      pointer-events: none;
      opacity: 0;
      transition: opacity var(--intro-ms) var(--intro-ease);
      will-change: opacity;
    }

    body.is-intro { overflow: hidden; }

    body.is-intro .page-intro-wrap {
      filter: blur(var(--intro-blur));
      transform: scale(var(--intro-scale));
      transform-origin: center;
    }

    body.is-intro .intro-wash { opacity: 1; }

    .corner-plus {
      position: fixed;
      z-index: 9999;
      font-family: "ABC Diatype", system-ui, sans-serif;
      font-weight: 700;
      font-size: var(--corner-size);
      line-height: 1;
      color: #000;
      user-select: none;
      pointer-events: none;
      transform-origin: center;
      will-change: transform, opacity;
      transform: rotate(0deg) scale(1);
      opacity: 1;
      transition: transform var(--plus-ms) var(--plus-ease),
                  opacity var(--plus-ms) var(--plus-ease);
    }

    .corner-plus.tl { top: var(--corner-inset); left: var(--corner-inset); }
    .corner-plus.tr { top: var(--corner-inset); right: var(--corner-inset); }
    .corner-plus.bl { bottom: var(--corner-inset); left: var(--corner-inset); }
    .corner-plus.br { bottom: var(--corner-inset); right: var(--corner-inset); }

    body.plus-merged .corner-plus.tl,
    body.plus-merged .corner-plus.bl {
      transform: rotate(360deg) scale(var(--left-scale));
      opacity: 1;
    }

    body.plus-merged .corner-plus.tr,
    body.plus-merged .corner-plus.br {
      transform: rotate(360deg) scale(var(--right-scale));
      opacity: 0;
    }

    .left-connector {
      position: fixed;
      z-index: 9998;
      width: var(--connector-width);
      background: #000;
      border-radius: 0;
      left: -9999px;
      top: -9999px;
      height: 0px;
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: opacity var(--connector-ms) var(--connector-ease);
      will-change: opacity;
      pointer-events: none;
    }

    body.plus-merged .left-connector { opacity: 1; }

    @keyframes studyCascadeIn {
      from {
        opacity: var(--cascade-from-opacity);
        transform: translateY(var(--cascade-from-y));
        filter: blur(var(--cascade-from-blur));
      }
      to {
        opacity: 1;
        transform: translateY(0);
        filter: blur(0);
      }
    }
  </style>
</head>

<body class="is-intro">
  <div class="corner-plus tl">＋</div>
  <div class="corner-plus tr">＋</div>
  <div class="corner-plus bl">＋</div>
  <div class="corner-plus br">＋</div>

  <div class="left-connector" aria-hidden="true"></div>
  <div class="intro-wash" aria-hidden="true"></div>

  <div class="page-intro-wrap">
    <slot />
  </div>

  <script is:inline>
    (() => {
      const root = document.documentElement;
      const $ = (sel) => document.querySelector(sel);

      const updateConnectorWidth = () => {
        const tl = $(".corner-plus.tl");
        if (!tl) return;
        const fs = parseFloat(getComputedStyle(tl).fontSize) || 28;
        const w = Math.max(2, Math.round(fs * 0.10));
        root.style.setProperty("--connector-width", `${w}px`);
      };

      const setConnectorMetrics = () => {
        const tl = $(".corner-plus.tl");
        const bl = $(".corner-plus.bl");
        const conn = $(".left-connector");
        if (!tl || !bl || !conn) return;

        const rTL = tl.getBoundingClientRect();
        const rBL = bl.getBoundingClientRect();

        const cx = rTL.left + rTL.width / 2;
        const gap = 14;
        const topY = rTL.bottom + gap;
        const bottomY = rBL.top - gap;
        const h = Math.max(0, bottomY - topY);
        const cy = topY + h / 2;

        conn.style.left = `${cx}px`;
        conn.style.top = `${cy}px`;
        conn.style.height = `${h}px`;
      };

      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          document.body.classList.remove("is-intro");
          updateConnectorWidth();
          setConnectorMetrics();
        });
      });

      window.addEventListener("resize", () => {
        updateConnectorWidth();
        setConnectorMetrics();
      });
    })();
  </script>
</body>
</html>
