---
const {
  title = "brandyura",
  description = "brandyura",
  ogImage = "/og.png",
} = Astro.props;

const siteUrl = "https://brandyura.com";
const canonical = new URL(Astro.url.pathname, siteUrl).toString();
const ogImageAbs = new URL(ogImage, siteUrl).toString();
---
<!doctype html>
<html lang="en" class="intro-prep">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{title}</title>

  <link rel="canonical" href={canonical} />
  <meta name="description" content={description} />

  <!-- Open Graph (square only) -->
  <meta property="og:site_name" content="brandyura" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:url" content={canonical} />

  <meta property="og:image" content={ogImageAbs} />
  <meta property="og:image:width" content="960" />
  <meta property="og:image:height" content="960" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:alt" content="brandyura preview" />

  <!-- Twitter/X (square-style card) -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={ogImageAbs} />

  <link rel="icon" href="/favicon.ico" />

  <link rel="preload" href="/fonts/ABCDiatype-Regular.woff" as="font" type="font/woff" crossorigin />
  <link rel="preload" href="/fonts/ABCDiatype-Bold.woff" as="font" type="font/woff" crossorigin />

  <style>
    @font-face {
      font-family: "ABC Diatype";
      src: url("/fonts/ABCDiatype-Regular.woff") format("woff");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "ABC Diatype";
      src: url("/fonts/ABCDiatype-Bold.woff") format("woff");
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #ffffff;
    }

    body {
      font-family: "ABC Diatype", system-ui, sans-serif;
      color: #000000;
      overflow-x: hidden;
    }

    /* Corner plus marks */
    :root {
      --corner-inset: 22px;
      --corner-size: 28px;
      --spin-ms: 520ms;

      /* Intro animation tuning */
      --intro-duration: 1400ms;   /* zoom-in time */
      --intro-delay: 1200ms;      /* how long it stays blurred/zoomed out */
      --intro-blur: 16px;         /* starting blur amount */
      --intro-scale: 0.72;        /* starting zoomed-out scale */
    }

    .corner-plus {
      position: fixed;
      z-index: 9999;
      font-family: "ABC Diatype", system-ui, sans-serif;
      font-weight: 700;
      font-size: var(--corner-size);
      line-height: 1;
      color: #000;
      user-select: none;
      pointer-events: none;
      transform: translateZ(0);
      will-change: transform;
    }

    .corner-plus.tl { top: var(--corner-inset); left: var(--corner-inset); }
    .corner-plus.tr { top: var(--corner-inset); right: var(--corner-inset); }
    .corner-plus.bl { bottom: var(--corner-inset); left: var(--corner-inset); }
    .corner-plus.br { bottom: var(--corner-inset); right: var(--corner-inset); }

    @keyframes cornerSpin {
      from { transform: rotate(0deg) translateZ(0); }
      to   { transform: rotate(360deg) translateZ(0); }
    }

    .corner-plus.spin {
      animation: cornerSpin var(--spin-ms) ease-in-out;
    }

    /* Intro wrapper */
    #app {
      width: 100%;
      min-height: 100%;
      transform-origin: 50% 35%;
      will-change: transform, filter, opacity;
    }

    /* Initial state (blurred + zoomed out) */
    html.intro-prep #app {
      filter: blur(var(--intro-blur));
      transform: scale(var(--intro-scale));
      opacity: 1;
    }

    /* Animate to normal */
    html.intro-run #app {
      animation: introIn var(--intro-duration) cubic-bezier(0.16, 1, 0.3, 1) var(--intro-delay) forwards;
    }

    @keyframes introIn {
      from {
        filter: blur(var(--intro-blur));
        transform: scale(var(--intro-scale));
      }
      to {
        filter: blur(0px);
        transform: scale(1);
      }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      html.intro-prep #app,
      html.intro-run #app {
        animation: none !important;
        filter: none !important;
        transform: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="corner-plus tl" aria-hidden="true">＋</div>
  <div class="corner-plus tr" aria-hidden="true">＋</div>
  <div class="corner-plus bl" aria-hidden="true">＋</div>
  <div class="corner-plus br" aria-hidden="true">＋</div>

  <div id="app">
    <slot />
  </div>

  <script is:inline>
    (() => {
      const html = document.documentElement;

      // kick intro after first paint
      requestAnimationFrame(() => {
        html.classList.add("intro-run");
        // remove prep class so it doesn't fight the animation
        html.classList.remove("intro-prep");
      });

      // spin corners on study clicks
      const SPIN_CLASS = "spin";

      const triggerSpin = () => {
        const pluses = document.querySelectorAll(".corner-plus");
        pluses.forEach((el) => {
          el.classList.remove(SPIN_CLASS);
          void el.offsetWidth;
          el.classList.add(SPIN_CLASS);
        });
      };

      const isStudyTrigger = (val) => {
        if (!val) return false;
        let s = val;
        try { s = decodeURIComponent(s); } catch (_) {}
        s = s.trim().toLowerCase();
        return s.startsWith("study:[//");
      };

      document.addEventListener(
        "click",
        (e) => {
          const t = e.target;
          if (!t || !t.closest) return;
          const el = t.closest("[data-study]");
          if (!el) return;
          const studyVal = el.getAttribute("data-study") || "";
          if (isStudyTrigger(studyVal)) triggerSpin();
        },
        { capture: true }
      );

      document.addEventListener(
        "animationend",
        (e) => {
          const t = e.target;
          if (t && t.classList && t.classList.contains("corner-plus")) {
            t.classList.remove(SPIN_CLASS);
          }
        },
        true
      );
    })();
  </script>
</body>
</html>
