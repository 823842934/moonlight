---
import FrameLayout from "../layouts/FrameLayout.astro";
---
<FrameLayout title="brandyura">
  <section class="hero">
    <div class="stack">
      <h1 id="logo">brandyura</h1>

      <div class="tree" aria-label="gallery tree">
        <div class="tree-viewport">
          <!-- GALLERY VIEW -->
          <div id="galleryView" class="view view--active">
            <div class="root">gallery</div>

            <div class="children">
              <button class="item item-btn" type="button" data-study="study1">├─ study1</button>
              <button class="item item-btn" type="button" data-study="study2">├─ study2</button>
              <button class="item item-btn" type="button" data-study="study3">├─ study3</button>
              <button class="item item-btn" type="button" data-study="study4">├─ study4</button>
              <button class="item item-btn" type="button" data-study="study5">├─ study5</button>
              <button class="item item-btn" type="button" data-study="study6">├─ study6</button>
              <button class="item item-btn" type="button" data-study="study7">├─ study7</button>
              <button class="item item-btn" type="button" data-study="study8">├─ study8</button>
              <button class="item item-btn" type="button" data-study="study9">├─ study9</button>
              <button class="item item-btn" type="button" data-study="study10">└─ study10</button>
            </div>
          </div>

          <!-- STUDY VIEW -->
          <div id="studyView" class="view" aria-live="polite">
            <button id="backBtn" class="back" type="button">← back</button>

            <div id="studyRoot" class="root">study</div>

            <div class="children children--indented">
              <div class="item cascade" data-cascade="1">├─ about</div>
              <div class="item cascade" data-cascade="2">├─ purpose</div>
              <div class="item cascade" data-cascade="3">└─ date</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <style>
    .hero {
      min-height: 100dvh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 5vw;
      background: transparent;
    }

    .stack {
      width: 100%;
      max-width: 100%;
    }

    h1 {
      font-family: "ABC Diatype", system-ui, sans-serif;
      font-weight: 700;
      font-size: clamp(56px, 16vw, 260px);
      letter-spacing: -0.05em;
      line-height: 1;
      margin: 0;
      width: 100%;
      text-align: center;
      color: inherit;
      transition: filter 0.25s ease;
      cursor: pointer;
    }

    .tree {
      margin-top: 0.5rem;
      font-family: "ABC Diatype", system-ui, sans-serif;
      font-weight: 400;
      font-size: clamp(14px, 3.5vw, 18px);
      letter-spacing: 0.02em;
      text-align: left;
      padding-left: 0.15em;
    }

    /* Prevent layout shift by giving the tree area a stable viewport */
    .tree-viewport {
      position: relative;
      min-height: 12.5rem;
    }

    .root {
      margin: 0;
    }

    .children {
      margin-top: 0.35rem;
      display: grid;
      gap: 0.18rem;
    }

    .item {
      white-space: pre;
      display: block;
      line-height: 1.25;
    }

    /* Clickable rows look like plain text */
    .item-btn {
      appearance: none;
      background: transparent;
      border: 0;
      padding: 0;
      margin: 0;
      text-align: left;
      font: inherit;
      color: inherit;
      cursor: pointer;
      line-height: 1.25;
    }

    .item-btn:active {
      opacity: 0.65;
    }

    .back {
      appearance: none;
      background: transparent;
      border: 0;
      padding: 0;
      margin: 0 0 0.35rem 0;
      text-align: left;
      font: inherit;
      color: inherit;
      cursor: pointer;
      line-height: 1.25;
    }

    .back:active {
      opacity: 0.65;
    }

    /* Views: crossfade/slide within a fixed viewport (no pushing the title) */
    .view {
      position: absolute;
      inset: 0;
      transform-origin: top left;
      transition: opacity 260ms ease, transform 260ms ease;
      will-change: opacity, transform;
    }

    .view:not(.view--active) {
      opacity: 0;
      transform: translateY(6px);
      pointer-events: none;
    }

    .view.view--active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    /* Cascade items: come in from RIGHT -> LEFT + fade */
    .cascade {
      opacity: 0;
      transform: translateX(16px);
      transition: opacity 260ms ease, transform 260ms ease;
      will-change: opacity, transform;
    }

    .view--active .cascade {
      opacity: 1;
      transform: translateX(0);
    }

    .view--active .cascade[data-cascade="1"] { transition-delay: 70ms; }
    .view--active .cascade[data-cascade="2"] { transition-delay: 140ms; }
    .view--active .cascade[data-cascade="3"] { transition-delay: 210ms; }

    @media (hover: hover) and (pointer: fine) {
      h1:hover {
        filter: blur(2px);
      }
    }

    .blur-temp {
      filter: blur(2px);
    }

    @media (prefers-reduced-motion: reduce) {
      .view,
      .cascade,
      h1 {
        transition: none;
      }
      .cascade {
        opacity: 1;
        transform: none;
      }
      .view {
        transform: none;
      }
    }
  </style>

  <script>
    const logo = document.getElementById("logo");
    const galleryView = document.getElementById("galleryView");
    const studyView = document.getElementById("studyView");
    const studyRoot = document.getElementById("studyRoot");
    const backBtn = document.getElementById("backBtn");
    const studyButtons = document.querySelectorAll("[data-study]");

    // Mobile tap blur for title
    if (logo) {
      logo.addEventListener("touchstart", (e) => {
        e.preventDefault();
        logo.classList.add("blur-temp");
        setTimeout(() => logo.classList.remove("blur-temp"), 1000);
      });
    }

    function replayCascade() {
      if (!studyView) return;
      const nodes = studyView.querySelectorAll(".cascade");

      // reset to initial state
      nodes.forEach((n) => n.classList.remove("cascade-play"));
      void studyView.offsetHeight; // reflow
      nodes.forEach((n) => n.classList.add("cascade-play"));
    }

    function showStudy(studyName) {
      if (studyRoot) studyRoot.textContent = studyName;

      // switch view
      if (galleryView) galleryView.classList.remove("view--active");
      if (studyView) studyView.classList.add("view--active");

      // replay cascade each time
      replayCascade();
    }

    function showGallery() {
      if (studyView) studyView.classList.remove("view--active");
      if (galleryView) galleryView.classList.add("view--active");
    }

    studyButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const name = btn.getAttribute("data-study");
        if (name) showStudy(name);
      });

      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        const name = btn.getAttribute("data-study");
        if (name) showStudy(name);
      });
    });

    if (backBtn) {
      backBtn.addEventListener("click", showGallery);
      backBtn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        showGallery();
      });
    }
  </script>
</FrameLayout>
