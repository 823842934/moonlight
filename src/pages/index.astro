---
import FrameLayout from "../layouts/FrameLayout.astro";
---
<FrameLayout title="brandyura">
  <section class="hero">
    <div class="stack">
      <h1 id="logo">brandyura</h1>

      <div class="tree" aria-label="gallery tree">
        <div class="tree-viewport" id="viewport">
          <!-- GALLERY VIEW -->
          <div id="galleryView" class="view view--active">
            <div class="root">gallery</div>

            <div class="children">
              <button class="item item-btn" type="button" data-study="study:[//000-00001]">├─ study:[//000-00001]</button>
              <button class="item item-btn" type="button" data-study="study:[//000-00002]">├─ study:[//000-00002]</button>
              <button class="item item-btn" type="button" data-study="study:[//000-00003]">├─ study:[//000-00003]</button>
              <button class="item item-btn" type="button" data-study="study:[//000-00004]">├─ study:[//000-00004]</button>
              <button class="item item-btn" type="button" data-study="study:[//000-00005]">├─ study:[//000-00005]</button>
              <button class="item item-btn" type="button" data-study="study:[//000-00006]">├─ study:[//000-00006]</button>
              <button class="item item-btn" type="button" data-study="study:[//000-00007]">├─ study:[//000-00007]</button>
              <button class="item item-btn" type="button" data-study="study:[//000-00008]">├─ study:[//000-00008]</button>
              <button class="item item-btn" type="button" data-study="study:[//000-00009]">├─ study:[//000-00009]</button>
              <button class="item item-btn" type="button" data-study="study:[//000-00010]">└─ study:[//000-00010]</button>
            </div>
          </div>

          <!-- STUDY VIEW -->
          <div id="studyView" class="view zoomed">
            <button id="backBtn" class="back" type="button"><span class="arrow">←</span><span class="label"> back</span></button>

            <div id="studyRoot" class="root">study</div>

            <div class="children children--indented">
              <div class="item cascade" data-cascade="1">├─ about</div>
              <div class="item cascade" data-cascade="2">├─ purpose</div>
              <div class="item cascade" data-cascade="3">└─ date</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <style>
    .hero {
      min-height: 100dvh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 5vw;
    }

    .stack {
      width: 100%;
      max-width: 100%;
    }

    h1 {
      font-family: "ABC Diatype", system-ui, sans-serif;
      font-weight: 700;
      font-size: clamp(56px, 16vw, 260px);
      letter-spacing: -0.05em;
      line-height: 1;
      margin: 0;
      width: 100%;
      text-align: center;
      transition: filter 0.35s ease;
    }

    .logo-blur {
      filter: blur(6px);
    }

    .tree {
      margin-top: 0.55rem;
      font-family: "ABC Diatype", system-ui, sans-serif;
      font-weight: 400;
      font-size: 15px;
      letter-spacing: -0.01em;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    .tree-viewport {
      width: 100%;
      max-width: 100%;
      overflow: visible;
      transform-origin: center left;
      transition: transform 500ms cubic-bezier(.4,0,.2,1);
    }

    .tree-viewport.zoom-in {
      transform: scale(1.25) translateX(40px);
    }

    /* HARD no-wrap everywhere for the directory labels */
    .root,
    .item,
    .item-btn,
    .back {
      white-space: nowrap;
      overflow-wrap: normal;
      word-break: normal;
      hyphens: none;
    }

    .root { margin: 0; }

    .children {
      margin-top: 0.35rem;
      display: grid;
      gap: 0.18rem;
      width: fit-content;
    }

    .item {
      line-height: 1.25;
      width: fit-content;
    }

    .item-btn {
      background: none;
      border: 0;
      padding: 0;
      font: inherit;
      color: inherit;
      cursor: pointer;
      text-align: left;
      display: inline-block;
      width: fit-content;
    }

    /* Hover wave effect for study buttons */
    .item-btn .prefix {
      display: inline-block;
    }

    .item-btn .wave-char {
      display: inline-block;
      transform: scale(var(--wave-scale, 1));
      transform-origin: center bottom;
      transition: transform 90ms ease;
      will-change: transform;
    }

    @media (prefers-reduced-motion: reduce) {
      .item-btn .wave-char {
        transition: none;
      }
    }

    .back {
      background: none;
      border: 0;
      padding: 0;
      font: inherit;
      color: inherit;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.15em;
    }

    .arrow { display: inline-block; transform: translateY(-0.02em); }

    .view {
      display: none;
      opacity: 0;
      transition: opacity 180ms ease;
    }

    .view--active {
      display: block;
      opacity: 1;
    }

    .zoomed {
      transform: scale(1.15);
      transform-origin: top left;
    }

    .cascade {
      opacity: 0;
      transform: translateX(16px);
      transition: opacity 260ms ease, transform 260ms ease;
    }

    .view--active .cascade {
      opacity: 1;
      transform: translateX(0);
    }

    .view--active .cascade[data-cascade="1"] { transition-delay: 80ms; }
    .view--active .cascade[data-cascade="2"] { transition-delay: 160ms; }
    .view--active .cascade[data-cascade="3"] { transition-delay: 240ms; }
  </style>

  <script>
    const viewport = document.getElementById("viewport");
    const logo = document.getElementById("logo");
    const galleryView = document.getElementById("galleryView");
    const studyView = document.getElementById("studyView");
    const studyRoot = document.getElementById("studyRoot");
    const backBtn = document.getElementById("backBtn");
    const studyButtons = document.querySelectorAll(".item-btn");

    function initWaveButton(btn) {
      const raw = (btn.textContent || "").replace(/\s+$/g, "");
      const match = raw.match(/^([├└]─\s*)(.*)$/);
      const prefix = match ? match[1] : "";
      const label = match ? match[2] : raw;

      // Build character spans for the label portion only (keeps the tree glyphs stable)
      const chars = Array.from(label);
      btn.innerHTML =
        (prefix ? `<span class="prefix">${prefix}</span>` : "") +
        chars
          .map((ch) => {
            const safe =
              ch === " "
                ? "&nbsp;"
                : ch
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;");
            return `<span class="wave-char">${safe}</span>`;
          })
          .join("");

      const spans = Array.from(btn.querySelectorAll(".wave-char"));
      if (!spans.length) return;

      let raf = 0;
      let lastX = 0;

      function applyWave() {
        raf = 0;
        const sigma = Math.max(14, parseFloat(getComputedStyle(btn).fontSize) * 0.9);
        const amp = 0.55;

        for (const sp of spans) {
          const r = sp.getBoundingClientRect();
          const cx = r.left + r.width / 2;
          const d = cx - lastX;
          const scale = 1 + amp * Math.exp(-(d * d) / (2 * sigma * sigma));
          sp.style.setProperty("--wave-scale", scale.toFixed(3));
        }
      }

      btn.addEventListener("pointermove", (e) => {
        lastX = e.clientX;
        if (!raf) raf = requestAnimationFrame(applyWave);
      });

      btn.addEventListener("pointerleave", () => {
        if (raf) cancelAnimationFrame(raf);
        raf = 0;
        for (const sp of spans) sp.style.setProperty("--wave-scale", "1");
      });
    }

    function showStudy(studyName) {
      // Blur the logo and zoom the viewport (existing animation)
      logo.classList.add("logo-blur");
      viewport.classList.add("zoom-in");

      galleryView.classList.remove("view--active");
      studyView.classList.add("view--active");

      // Update the "study" root label
      studyRoot.textContent = studyName || "study";
    }

    function showGallery() {
      // Remove blur and zoom (existing animation)
      logo.classList.remove("logo-blur");
      viewport.classList.remove("zoom-in");

      studyView.classList.remove("view--active");
      galleryView.classList.add("view--active");
    }

    studyButtons.forEach((btn) => {
      initWaveButton(btn);

      btn.addEventListener("click", () => showStudy(btn.dataset.study));
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        showStudy(btn.dataset.study);
      });
    });

    backBtn.addEventListener("click", showGallery);
    backBtn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      showGallery();
    });
  </script>
</FrameLayout>
